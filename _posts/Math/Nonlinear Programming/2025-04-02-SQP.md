---
title: 逐次2次計画法 (Successive Quadratic Programming, SQP)
date: 2025-04-02 12:00 +0900
categories: [Math, Nonlinear Programming]
tags: [Optimization, SQP, KKT, Quasi-Newton, Numerical, Algorithm]
author: Youkoutaku
math: true
mermaid: true
---

### 逐次2次計画法 (Successive Quadratic Programming, SQP)
逐次2次計画法(SQP)は，準ニュートン法に基づく非線形制約最適化問題を、**二次計画問題（QP）** に近似して解く．

#### 2次計画問題（QP）の定式化

$$
\begin{aligned}
&\text{minimize : } &f(x_k) + \nabla f_k(x)^T\Delta x_k+\frac{1}{2}\Delta x_k^TH_k\Delta x_k \\
&\text{subject to : } & g_i(x_k) + \frac{\partial g_i}{\partial x}(x_k)\Delta x_k \leq 0 \quad \text{for } i = 1, 2, \ldots, m \\
& &h_j(x_k) + \frac{\partial h_j}{\partial x}(x_k) \Delta x_k \leq 0 \quad \text{for } i = 1, 2, \ldots, p
\end{aligned}
$$

- $x\in\mathbb{R}^n:$ 決定変数
- $f(x)\in\mathbb{R}:$ 目的関数
- $\nabla f(x_k)\in\mathbb{R}^{n}$：目的関数の勾配
- $H_k\in\mathbb{R}^{n\times n}$：ラグランジュ関数$L(x,\lambda,\mu)$のHessian matrix（ヘッセ行列）の近似（準ニュートン法）
- $\Delta x_k\in\mathbb{R}^n$：更新方向（次の解への移動ベクトル）
- $h_j(x)\in\mathbb{R}$：等式制約
- $g_i(x)\in\mathbb{R}$：不等式制約

2次計画問題を解いて，$\Delta x_k, \lambda_k, \mu_k$を求めて $x_{k+1}=x_k+\Delta x_k$という更新を繰り返したとき，$\Delta x_k\to0, x_k\to x^\ast, \lambda_k\to\lambda^\ast, \mu_k\to\mu^\ast$と収束すれば，$(x^\ast,\lambda^\ast,\mu^\ast)$においてKKT条件が成立することになる．ここで，$\Delta x_k$の2次計画問題を解くとき，評価関数$f(x_k)$定数項は無視できる．

ただし，$H_k$ラグランジュ関数のヘッセ行列は，一般に正定とは限らない．しかし，2次計画問題において$H_k$が正定であることが必要なので、準ニュートン法における**BFGS法**や**DFP法**で$H_k$を更新していく．

#### アルゴリズム

```
入力: 初期点 x0, 正定行列H0, 収束許容誤差 ε
1. 初期化: k = 0, x_k = x0
2. repeat:
    3. QP 問題を定式化:
       Minimize:   ∇f(x_k)^T dx + (1/2) dx^T H_k dx
       Subject to: ∇h(x_k)^T dx + h(x_k) = 0
                   ∇g(x_k)^T dx + g(x_k) ≤ 0
    4. QP 問題を解いて dx_k, lambda_k, mu_k を取得
    5. 収束チェック:
       if ||d_k|| < ε then
           break
       end if
    6. x_{k+1} = x_k + dx_k あるいは x_{k+1} = x_k + alpha_k*dx_k (Line search)
    7. y_k = ∇L(x_{k+1},lambda_k, mu_k) - ∇L(x_k,lambda_k, mu_k)
    8. BFGSやDPFに基づき，H_k を取得
    9. k = k + 1
end repeat
```

---
## 参考資料
- [大塚 敏之](https://www.ids.sys.i.kyoto-u.ac.jp/index.html), 非線形最適制御入門(Introduction to Nonlinear Optimal Control)，コロナ社, 2011. 